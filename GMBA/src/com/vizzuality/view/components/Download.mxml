<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" verticalCenter="0" horizontalCenter="0" height="407" width="634" backgroundColor="#1A1A1B" backgroundAlpha="1" 
	xmlns:utils="com.vizzuality.utils.*" xmlns:components="com.vizzuality.view.components.*" currentState="filterCriteria" >
	
	<mx:states>
		<mx:State name="filterCriteria">
			<mx:RemoveChild target="{downloadsize1}"/>
			<mx:RemoveChild target="{downloadrepeat1}"/>
			<mx:RemoveChild target="{hbox1}"/>
			<mx:RemoveChild target="{download_world}"/>
			<mx:RemoveChild target="{download_bound}"/>
			<mx:RemoveChild target="{hbox4}"/>
			<mx:RemoveChild target="{canvas1}"/>
			<mx:SetProperty target="{canvas2}" name="height" value="247"/>
			<mx:RemoveChild target="{terms}"/>
			<mx:RemoveChild target="{label6}"/>
			<mx:RemoveChild target="{button2}"/>
			<mx:RemoveChild target="{label7}"/>
			<mx:RemoveChild target="{hbox2}"/>
			<mx:AddChild position="lastChild">
				<utils:ShadowButton height="32" label="Cancel" color="#FFFFFF" fontSize="17" fontWeight="normal" click="MyEventDispatcher.onCloseDownloadWindow(); currentState = 'filterCriteria';"
								useHandCursor="true" mouseChildren="false" buttonMode="true" styleName="download"  right="454" bottom="30" width="150" id="shadowbuttonCancel"/>
			</mx:AddChild>
			<mx:AddChild relativeTo="{shadowbutton1}" position="before">
				<utils:ShadowButton height="32" label="Continue" color="#FFFFFF" fontSize="17" fontWeight="normal" click="initLoading()"
								useHandCursor="true" mouseChildren="false" buttonMode="true" styleName="download"  right="30" bottom="30" width="150" id="shadowbuttonContinue"/>
			</mx:AddChild>
			<mx:RemoveChild target="{shadowbutton1}"/>
			<mx:AddChild relativeTo="{canvas2}" position="lastChild">
				<mx:Label x="10" y="16" text="YOU HAVE SELECTED" color="#FFFFFF" id="id_title_filter" fontSize="18"/>
			</mx:AddChild>
			<mx:AddChild relativeTo="{canvas2}" position="lastChild">
				<mx:Label x="10" y="67" text="ELEVATION" color="#F3C400" id="id_elevation_filter" fontSize="14" />
			</mx:AddChild>
			<mx:AddChild relativeTo="{canvas2}" position="lastChild">
				<mx:Label x="10" y="107" text="RELIEF" color="#F3C400" id="id_relief_filter" fontSize="14"/>
			</mx:AddChild>
			<mx:AddChild relativeTo="{canvas2}" position="lastChild">
				<mx:Label x="10" y="147" text="VEGETATION TYPE" color="#F3C400" id="id_vegetation_filter" fontSize="14"/>
			</mx:AddChild>
			
			<mx:AddChild relativeTo="{id_relief_filter}" position="before">
				<mx:Label x="250" y="69" text="ELEVATION" color="#FFFFFF" id="id_elevation_filter0" fontSize="12" />
			</mx:AddChild>
			<mx:AddChild relativeTo="{id_relief_filter}" position="before">
				<mx:Label x="358.5" y="69" text="ELEVATION" color="#FFFFFF" id="id_elevation_filter1" fontSize="12" />
			</mx:AddChild>
			<mx:AddChild relativeTo="{id_vegetation_filter}" position="before">
				<mx:Label x="250" y="107" text="RELIEF" color="#FFFFFF" id="id_relief_filter0" fontSize="12"/>
			</mx:AddChild>
			<mx:AddChild relativeTo="{id_vegetation_filter}" position="before">
				<mx:Label x="358.5" y="107" text="RELIEF" color="#FFFFFF" id="id_relief_filter1" fontSize="12"/>
			</mx:AddChild>
			<mx:AddChild relativeTo="{canvas2}" position="lastChild">
				<mx:Text x="250" y="147" text="VEGETATION" color="#FFFFFF" id="id_vegetation_filter0" fontSize="12" height="57" width="300"/>
			</mx:AddChild>
			
			<mx:AddChild relativeTo="{id_vegetation_filter0}" position="before">
				<mx:Label x="250" y="212" text="-" color="#FFFFFF" id="id_taxon_filter1" fontSize="12"/>
			</mx:AddChild>
			<mx:AddChild relativeTo="{id_taxon_filter1}" position="before">
				<mx:Label x="10" y="210" text="TAXON" color="#F3C400" id="id_taxon_filter" fontSize="14"/>
			</mx:AddChild>
			<mx:AddChild relativeTo="{canvas2}" position="lastChild">
				<mx:Label x="308" y="70" text="..." color="#FFFFFF" fontSize="12" id="label8"/>
			</mx:AddChild>
			<mx:AddChild relativeTo="{canvas2}" position="lastChild">
				<mx:Label x="308" y="107" text="..." color="#FFFFFF" fontSize="12"/>
			</mx:AddChild>
			
			
		</mx:State>
		<mx:State name="loading">
			<mx:RemoveChild target="{downloadsize1}"/>
			<mx:RemoveChild target="{downloadrepeat1}"/>
			<mx:RemoveChild target="{hbox1}"/>
			<mx:AddChild relativeTo="{canvas1}" position="lastChild">
				<mx:SWFLoader horizontalCenter="0" verticalCenter="0" width="32" height="32" source="@Embed('/assets/loadAnimation.swf')"/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="processing">
			<mx:RemoveChild target="{label1}"/>
			<mx:RemoveChild target="{vbox1}"/>
			<mx:RemoveChild target="{hbox2}"/>
			<mx:RemoveChild target="{shadowbutton1}"/>
			<mx:AddChild position="lastChild">
				<mx:Label text="We are processing your request" horizontalCenter="0" verticalCenter="-32" color="#FFFFFF" fontSize="25" id="label2"/>
			</mx:AddChild>
			<mx:AddChild position="lastChild">
				<mx:Label text="It could take some minutes. Please be patient." horizontalCenter="0" verticalCenter="-6" color="#FFFFFF" fontSize="12" id="label3"/>
			</mx:AddChild>
			<mx:AddChild position="lastChild">
				<mx:ProgressBar horizontalCenter="0" verticalCenter="31" color="#FFFFFF" label=" " enabled="true" id="progressbar1"/>
			</mx:AddChild>
		</mx:State>
		<mx:State name="ready" basedOn="processing">
			<mx:SetProperty target="{label2}" name="text" value="Your request is ready"/>
			<mx:RemoveChild target="{progressbar1}"/>
			<mx:SetProperty target="{hbox3}" name="y" value="168"/>
			<mx:SetProperty target="{button1}" name="styleName" value="linkButton"/>
			<mx:SetStyle target="{hbox3}" name="horizontalGap" value="0"/>
			<mx:SetStyle target="{hbox3}" name="horizontalCenter" value="0"/>
			<mx:SetStyle target="{label2}" name="verticalCenter" value="-53"/>
			<mx:AddChild position="lastChild">
				<mx:HBox id="hbox3" y="170" horizontalCenter="0" horizontalGap="0">
					<mx:Button label="Click here"  id="button1" paddingLeft="0" paddingRight="0" paddingBottom="2" paddingTop="0" styleName="linkButton"/>
					<mx:Label text="if your download does not start automatically in 3 seconds."  id="label5" color="#FFFFFF" fontSize="12"/>
				</mx:HBox>
			</mx:AddChild>
			<mx:AddChild position="lastChild">
				<utils:ShadowButton height="32" label="Create another request" color="#FFFFFF" fontSize="17" fontWeight="normal"
					useHandCursor="true" mouseChildren="false" buttonMode="true" styleName="download" y="243" horizontalCenter="0"/>
			</mx:AddChild>
			<mx:RemoveChild target="{label3}"/>
		</mx:State>
	</mx:states>
	
	
	<mx:Script>
		<![CDATA[
			import com.google.maps.LatLngBounds;
			import mx.collections.ArrayCollection;
			import com.vizzuality.events.ChangeMapZoom;
			import gs.TweenLite;
			import com.vizzuality.utils.Resource;
			import com.vizzuality.events.MyEventDispatcher;
			
			public var elevationValues: ArrayCollection;
			public var reliefValues: ArrayCollection;
			public var vegetationValues: ArrayCollection;
			public var bound: LatLngBounds;
			public var zoom: Number;
			
			private var timer:Timer;			
			
			public function setCriteriaValues():void{
				
				id_elevation_filter0.text = elevationValues[0];
				id_elevation_filter1.text = elevationValues[1];
				
				id_relief_filter0.text = reliefValues[0];
				id_relief_filter1.text = reliefValues[1];
				
				id_vegetation_filter0.text = "";
	
				if (vegetationValues.length != 0) {
							
					if (vegetationValues[0]) {
							id_vegetation_filter0.text = "All"
					}
					else{
						
						if (vegetationValues[1]){
							id_vegetation_filter0.text += "Far above";
						}
						if (vegetationValues[2]){
							if (id_vegetation_filter0.text != "") id_vegetation_filter0.text += ", ";
							
							id_vegetation_filter0.text += "Adjacent above";
						}
						if (vegetationValues[3]){
							if (id_vegetation_filter0.text != "") id_vegetation_filter0.text += ", ";
							
							id_vegetation_filter0.text += "Adjacent below";
						}
						if (vegetationValues[4]){
							
							if (id_vegetation_filter0.text != "") id_vegetation_filter0.text += ", ";
							
							id_vegetation_filter0.text += "Below";	
							
						}
						if (vegetationValues[5]){
							if (id_vegetation_filter0.text != "") id_vegetation_filter0.text += ", ";
							
							id_vegetation_filter0.text += "Dry desert";
						}
						if (vegetationValues[6]){
							if (id_vegetation_filter0.text != "") id_vegetation_filter0.text += ", ";
							
							id_vegetation_filter0.text += "Arid grassland";
						}
						if (vegetationValues[7]){
							if (id_vegetation_filter0.text != "") id_vegetation_filter0.text += ", ";
							
							id_vegetation_filter0.text += "Above - Arid";
						}
						if (vegetationValues[8]){
							if (id_vegetation_filter0.text != "") id_vegetation_filter0.text += ", ";
							
							id_vegetation_filter0.text += "Below - Arid";
						}
					}
					
				}	  
				
			}
			private function initLoading():void{
				timer = new Timer(3000,0);
				timer.addEventListener(TimerEvent.TIMER,onGetData);
				timer.start();	
				
				currentState='loading';
			}
			
			private function onCreationComplete():void {
				
				MyEventDispatcher.addEventListener(ChangeMapZoom.CHANGED, onChangeMapZoom);
				
			}	
			
			private function onGetData(event:TimerEvent):void {
				
				timer.stop();
				timer.removeEventListener(TimerEvent.TIMER,onGetData);
				
				this.currentState = "";
				
			}
			private function onChangeMapZoom(ev:ChangeMapZoom): void {
				if (Number(ev.zoom)<=2) {
					download_world.selected_item = true;
					download_bound.selected_item = false;
				} else {
					download_world.selected_item = false;
					download_bound.selected_item = true;
				}
			}		
			
			private function onClickToDownload():void {
				
				currentState = 'processing';
				TweenLite.to(this, 5, {delay:3,onComplete:onFinishTween2});
				
 			}
			
/* 			private function onFinishTween():void {
				currentState = 'processing';
				TweenLite.to(this, 5, {delay:3,onComplete:onFinishTween2});			
			}
 */			
			private function onFinishTween2():void {
				currentState = 'ready';
				TweenLite.to(this, 5, {delay:3,onComplete:onFinishTween3});						
			}	
			
			private function onFinishTween3():void {
				MyEventDispatcher.onCloseDownloadWindow();
				currentState = 'loading';
			}	
			
			private function activateDownload():void{
				if (shadowbutton1.enabled == true)
					shadowbutton1.enabled = false;
				else
					shadowbutton1.enabled = true;
			}
			
		]]>
	</mx:Script>
	
	
	<mx:Button  label="X" color="#FFFFFF" styleName="nullButton" textDecoration="normal" width="30" right="3" top="6" toolTip="Close" useHandCursor="true" 
		buttonMode="true" mouseChildren="false" click="MyEventDispatcher.onCloseDownloadWindow();currentState = 'filterCriteria';"/>
	
	<mx:VBox left="30" right="30" top="35" verticalGap="0" id="vbox1">
		<mx:Label text="FILTER CRITERIA" color="#FFFFFF" fontWeight="normal" fontSize="13"  width="100%" height="23" id="label1"/>
		<mx:Spacer height="18" />
		<mx:Canvas height="135" width="574" backgroundColor="#121213" id="canvas2" horizontalScrollPolicy="off">
			<mx:HBox  horizontalGap="15" left="20" right="20" top="21" bottom="23" id="hbox4">
				<components:DownloadType id="download_world" click="download_world.selected_item=true; download_bound.selected_item=false;" world_type="World" selected_item="false" />
				<components:DownloadType id="download_bound" click="download_world.selected_item=false; download_bound.selected_item=true;" world_type="Bound" selected_item="true" />
			</mx:HBox>
		</mx:Canvas>
		<mx:Canvas width="574" height="118" backgroundColor="#121213" horizontalScrollPolicy="off" verticalScrollPolicy="off" id="canvas1">
			<mx:HRule width="100%" height="1"  strokeWidth="1" strokeColor="#19191A"/>
			
			<mx:HBox horizontalGap="0" right="20" left="20" top="30" horizontalScrollPolicy="off" verticalScrollPolicy="off" id="hbox1">
				<components:DownloadSize  id="downloadsize1"/>
				<components:DownloadRepeat label_number="23Million" label_text="OCCURENCES" id="downloadrepeat1"/>
				<components:DownloadRepeat label_number="12Million" label_text="OBSERVATIONS" />
				<components:DownloadRepeat label_number="8Million" label_text="SPECIMENS" />
				<components:DownloadRepeat label_number="1658" label_text="PROVIDERS" bar="false"/>
			</mx:HBox>
		</mx:Canvas>
	</mx:VBox>
	
	
	<mx:HBox  bottom="30" left="30" width="412" borderStyle="none" horizontalGap="0" horizontalScrollPolicy="off" id="hbox2">
		<mx:CheckBox id="terms" label="" cornerRadius="10" click="activateDownload()"/>
		<mx:Label text="Before continue, you must accept the" fontSize="11" color="#FFFFFF" paddingLeft="3" id="label6"/>
		<mx:Button label="terms and conditions" styleName="linkButton" paddingLeft="0" paddingRight="0" useHandCursor="true" buttonMode="true" mouseChildren="false" paddingTop="0" paddingBottom="3" click="navigateToURL(new URLRequest('..//bin-debug/html/termsAndConditions.html'))" id="button2"/>
		<mx:Label text="of the service" fontSize="11" color="#FFFFFF" id="label7"/>
	</mx:HBox>	
	<utils:ShadowButton height="32" label="Download" color="#FFFFFF" fontSize="17" fontWeight="normal" click="onClickToDownload()"
					useHandCursor="true" mouseChildren="false" buttonMode="true" styleName="download"  right="30" bottom="30" width="150" id="shadowbutton1"  enabled="false"/>
</mx:Canvas>
