<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:header="com.vizzuality.view.header.*" xmlns:footer="com.vizzuality.view.footer.*" addedToStage="gaTracker.debug.minimizedOnStart=true;"
	layout="absolute" backgroundGradientAlphas="[1.0, 1.0]"
	backgroundGradientColors="[#E9F4FF, #D7E8FA]" creationComplete="initApp()" xmlns:components="com.google.analytics.components.*" xmlns:map="com.vizzuality.view.map.*">
	<mx:Script>
		<![CDATA[
			import com.vizzuality.view.AppStates;
			import asual.SWFAddressEvent;
			import asual.SWFAddress;
			import com.google.maps.MapEvent;
			import com.google.maps.Map;
			import mx.effects.easing.Exponential;
			import mx.events.ResizeEvent;
			import mx.managers.ToolTipManager;
			
			//To control the moving of the left an right screens
			private var isResizing:Boolean=false;
			private var isInLeftState:Boolean=true;
			
			public var map:Map;
			
			
			private function initApp():void {
				
				
				//Modify Tooltip behaviour so that it show inmediately
				ToolTipManager.showDelay = 0;
				ToolTipManager.hideDelay = 4000;		
				
			}
			
			public function onMapReady():void {				
				//We initialize the SWFAddress
				SWFAddress.addEventListener(SWFAddressEvent.CHANGE, handleSWFAddress);

				//Ok, after here we are totally preinitialize.
				mainCanvas.enabled=true;
				
				
				
				
			}
			
			private function handleSWFAddress(event:SWFAddressEvent):void {
				if(event.pathNames.length>1) {
					AppStates.gi().topState=event.pathNames[0];
					AppStates.gi().secondState=event.pathNames[1];
				} 
				else if(event.pathNames.length>0) {
					AppStates.gi().topState=event.pathNames[0];					
					AppStates.gi().secondState='';					
				}
				else {
					
					//This will be the default states if the application are not started
					//with states.
					AppStates.gi().topState=AppStates.WORLD;
					AppStates.gi().secondState=AppStates.ABOUT;
				}
			}	
				

			/**
			 * Toggle between full screen and not full screen.
			 */ 			
			public function toggleFullScreen():void{
	            try {
	            	var tim:Timer;
	                switch (Application.application.stage.displayState) {
	                    case StageDisplayState.FULL_SCREEN:
	                        Application.application.stage.displayState = StageDisplayState.NORMAL;
	                        tim = new Timer(1000,1);
			            	tim.addEventListener(TimerEvent.TIMER, function(event:TimerEvent):void {	
			            		dispatchEvent(new Event(ResizeEvent.RESIZE));
			            	});
	                        break;
	                    default:
	                        Application.application.stage.displayState = StageDisplayState.FULL_SCREEN;
	                        tim = new Timer(1000,1);
			            	tim.addEventListener(TimerEvent.TIMER, function(event:TimerEvent):void {	
			            		dispatchEvent(new Event(ResizeEvent.RESIZE));
			            	});
	                        
	                        break;
	                }
	            } catch (err:SecurityError) {
	                // ignore
	                trace(err.message);
	            }
			}    
			
			
		]]>
	</mx:Script>
	<mx:VBox id="mainVBox" width="100%" height="100%" verticalGap="0">
		<header:Header id="header" />
		<mx:Canvas id="mainCanvas" width="100%" height="100%" horizontalScrollPolicy="off" verticalScrollPolicy="off" horizontalCenter="0" enabled="false">
			<map:MapCanvas id="mapCanvas" width="100%" height="100%" backgroundColor="#A8A8A8"/>
		</mx:Canvas>
		<footer:Footer id="footer"/>
	</mx:VBox>
	
    <mx:Move id="moveEffect" 
        duration="500" 
        easingFunction="{Exponential.easeInOut}" 
        perElementOffset="20"/>			
	<components:FlexTracker id="gaTracker" account="UA-7333475-1" mode="AS3" visualDebug="false" /> 	
	<mx:Style source="com/vizzuality/view/styles.css"/>
</mx:Application>
