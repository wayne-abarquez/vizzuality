<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="47" xmlns:components = "com.vizzuality.components.*" backgroundColor="#FFFFFF"
	 verticalScrollPolicy="off" horizontalScrollPolicy="off" dataChange="doEffect()" alpha="0" xmlns:treebrowser="com.vizzuality.view.treebrowser.*"
	 styleName="{style}" backgroundSize="100%" rollOver="handleOver()" rollOut="handleOut()" click="handleClick()">

 	<!--click="onClickItemList()"-->

	<mx:Script>
		<![CDATA[
			import mx.effects.Tween;
			import com.ninem.controls.TreeBrowser;
			import gs.TweenLite;
			import mx.binding.utils.BindingUtils;
			import mx.collections.ArrayCollection;
			import mx.core.Application;
			
			[Bindable]
            private var taxon:String;
            [Bindable]
            private var bool:Boolean;
			[Bindable]
            private var commonName:ArrayCollection;

			public var treeBrowserParent:TreeBrowser;
			[Bindable]
			public var style:String;
			
			[Embed(source='/com/vizzuality/style/skin/treeBrowserSkin.swf', symbol='miniArrow')]
			[Bindable]
			public var miniArrow:Class;
			
			private var object: Object;
			
			private var sel:Boolean = false;
		
			
           	public override function set data(value:Object):void{
                super.data = value;
                if(value == null){
                	taxon="";
                	//this.alpha=0;
                	flickrImg.source=null;
                	combo.visible=false;
                	bool=false;
                    return;
                }
                if(value.name != taxon) {
	                taxon = value.name;
                	flickrImg.source=value.icon_url;
                	if (value.english!=null) {
                		commonName = new ArrayCollection();
                		if (value.english!=null) {
		                	commonName.addItem("[EN] " + value.english);
		                } else {
		                	commonName.addItem("[EN]");
		                }
		                if (value.english!=null) {
		                	commonName.addItem("[ES] " + value.spanish);
		                } else {
		                	commonName.addItem("[ES]");
		                }
		                if (value.english!=null) {
		                	commonName.addItem("[DE] " + value.german);
		                } else {
		                	commonName.addItem("[DE]");
		                }
		                if (value.english!=null) {
		                	commonName.addItem("[FR] " + value.french);
		                } else {
		                	commonName.addItem("[FR]");
		                }
		                combo.dataProvider=commonName;
		                combo.visible = true;
                		BindingUtils.bindProperty(combo, "selectedIndex", treeBrowserParent,"comboDefault");
                	} else {
                		combo.visible = false;
                	}
	                bool = value.has_children;
                }
                this.alpha=0;
            }

            private function doEffect():void{
            	TweenLite.to(this,1,{alpha:1});	 
            }
            private function changeCombo(ev: Event):void {
            	treeBrowserParent.comboDefault = ev.target.selectedIndex;
            }
            
            private function handleOver():void{
            	if(!sel){
            		TweenLite.to(canvasOver,.3,{alpha:1});
            	}	
            }
            
            private function handleOut():void{
            	if(!sel){
            		TweenLite.to(canvasOver,.3,{alpha:0});
            	}	
            }
            
            public function setSelected():void{
            	sel = true;
            	canvasOver.alpha = 1;
            }

            public function setUnselected():void{
            	sel = false;
            	canvasOver.alpha = 0;
            }
            
            private function handleClick():void{
				//dispatchEvent(new TreeBrowserItemClickEvent("ITEM_CLICK",this,true));            	
            }
            
		]]>
	</mx:Script>
	<mx:Canvas id="canvasOver" width="100%" height="100%" styleName="itemOver" alpha="0" backgroundSize="100%"/>
    <mx:Text text="{taxon}" textAlign="left" left="49" fontSize="15" width="165" fontFamily="DINOT-Bold" color="#FFFFFF" leading="-4" letterSpacing="-1" top="2"/>
    <mx:ComboBox id="combo" textAlign="left" verticalCenter="9" left="78" fontSize="13" fontStyle="italic" width="183.93333" height="22" change="changeCombo(event)"/>
    <mx:Canvas x="5" width="41" height="38" backgroundColor="#FFFFFF" verticalCenter="-2" borderStyle="none"
    	verticalScrollPolicy="off" horizontalScrollPolicy="off">
        <mx:Image id="flickrImg" horizontalAlign="center" verticalAlign="middle" verticalCenter="0" horizontalCenter="0"/>
        <mx:Image source="@Embed('/com/vizzuality/style/assets/borderTreeThumb.png')"  y="0"/>
    </mx:Canvas>
    <mx:Image source="{miniArrow}" right="8" verticalCenter="-2"/>
   
</mx:Canvas>
